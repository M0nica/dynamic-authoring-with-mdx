<SlidePage>

<Cover>

# Migrating Gatsby Blog to MDX üìù

Monica Powell &bull; MDX Conf 2020

</Cover>

---

# Hi, I'm Monica üëãüèæ

I'm a software engineer who is passionate about making contributing to open-source more approachable, creating technology to elevate people, and building community. I recently started using MDX and am looking forward to sharing more about my MDX migration...

<img
  style={{ maxWidth: "20%", textAlign: "center", display: "inline" }}
  src="/animonica.png"
/>

<SpeakerNotes>
  {" "}
  I'm Monica! I'm a software engineer and community organizer. I'm passionate
  about making technology, like open-source, more accessible and created a
  Meetup group, React Ladies for women and non-binary react developers.
</SpeakerNotes>

---

I was happy with my Gatsby site with Remark plugins, so...

# Why did I migrated from Remark to MDX?

- FOMO Driven Development
- to create engaging and interactive content!

<SpeakerNotes>
  Why not upgrade to MDX? I was hearing other developers talk about the
  superpowers of MDX and wanted to check it out for myself. I was especially
  interested in creating engaging and interactive content and had seen fun
  examples of content that resonated with me that used MDX.
</SpeakerNotes>

---

# Transformer Remark

- Remark is a collection of Markdown parser plugins that check, lint, generate and compiles Markdown.

- In Gatsby, Remark Transformer plugins are used in the `gatsby-config` to transform
  Markdown on a site into HTML.

<img style={{ maxWidth: "50%", textAlign: "center" }} src="/MDXtoHTML.png" />

---

# Remark plugins can be used to:

- autolink headers with anchor tags
- process responsive images
- add syntax highlight
- embed content
- and more!

---

# Remark plugins can be used to:

<img
  style={{ maxWidth: "50%", textAlign: "center" }}
  src="/codepen-embed.png"
/>

---

# Remark plugins can be used to:

<img style={{ maxWidth: "40%", textAlign: "center" }} src="/tweet-embed.png" />

---

# Goodbye gatsby-transformer-remark, Hello gatsby-plugin-mdx üëãüèæ

- Gatsby-plugin-mdx is the official integration for using MDX with Gatsby

- Can be used in combination with Remark plugins.

<SpeakerNotes>
  {" "}
  Considered a regular Gatsby plugin vs. Remark plugin{" "}
</SpeakerNotes>

---

# What did migrating look like

```shell
yarn add @mdx-js/mdx @mdx-js/react gatsby-plugin-mdx
yarn remove gatsby-transformer-remark
```

Updating `gatsby-config`:

- replace ~~gatsby-transformer-remark~~ with `gatsby-plugin-mdx`
- replace ~~gatsby-plugin-my-social-cards~~ with `gatsby-remark-twitter-cards`

---

# What did migrating look like

Updating queries and references to Markdown nodes to replace references to `allMarkdownRemark` to `allMdx`:

- ~~`const posts = result.data.allMarkdownRemark.edges`~~ to
  `const posts = result.data.allMDX.edges`

- ~~`node.internal.type ===`MarkdownRemark``~~ to `node.internal.type ===`Mdx``

---

# Cannot Query Field ü§Ø

<Callout variant="danger">
  error Cannot query field "body" on type "Mdx". Did you mean "rawBody"?
  graphql/template-strings
</Callout>

After installing `gatsby-plugin-mdx` and updating all references to Markdown to MDX...

<SpeakerNotes>
  I ran into an error accessing some of the fields that should be available for
  mdx nodes like `body`, `timeToRead` and `excerpt`.
</SpeakerNotes>

---

# Debugging Conflicting Gatsby Plugins üïµüèæ‚Äç‚ôÄÔ∏è

1. Commented out all of the plugins in gatsbyRemarkPlugins
2. Confirmed that all of the data that should be available to query from mdx was available all gatsbyRemarkPlugins were (temporarily) removed
3. Re-added each plugin one-by-one to identify the culprit
4. Identified conflict between `gatsby-plugin-mdx` and `gatsby-plugin-my-social-cards`.

---

# Resolving Conflicting Gatsby Plugins

- Plugins that transform the Abstract Syntax Tree (AST) can sometimes conflict with each other or behave in unexpected ways.
- Sometimes re-ordering plugins in `gatsby-config` can resolve conflicts.

<Callout>
  {" "}
  Solution: replace gatsby-plugin-my-social-cards with
  gatsby-remark-twitter-cards
</Callout>

<SpeakerNotes>
  There was a conflict with `gatsby-plugin-mdx` and the plugin,
  `gatsby-plugin-my-social-cards`, used to generate Open Graph images for all of
  my posts.
</SpeakerNotes>

---

# What have I done with MDX so far...

- ‚ú® Upgraded ‚ú® components for code snippets and table of contents
- created additional Callout components to complement markdown quotes
- Added dynamic slider

---

```jsx
import { MDXProvider } from "@mdx-js/react";
import { MDXRenderer } from "gatsby-plugin-mdx";

const components = {
  /* stash React components to be used in MDX blog posts here! */
};

class BlogPostTemplate extends React.Component {
  render() {
    const post = this.props.data.mdx;
    if (!post) return null;

    return (
      <MDXProvider components={components}>
        <MDXRenderer>{post.body}</MDXRenderer>
      </MDXProvider>
    );
  }
}
```

<SpeakerNotes>
  But first we need to wrap the MDXProvider and MDXRenderer around blog posts
</SpeakerNotes>

---

# Table of Contents Component

<img
  style={{ maxWidth: "40%", textAlign: "center" }}
  src="/table-of-contents-visual.png"
/>

---

```jsx
import "./TableOfContents.scss";
function TableOfContents({ headings }) {
  return (
    <div className="table-of-contents">
      <h2>Table of Contents</h2>
      <ul>
        {headings.items &&
          headings.items.map((item) => (
            <li key={item.url}>
              <a href={item.url}>{item.title}</a>{" "}
            </li>
          ))}
      </ul>
    </div>
  );
}
```

<SpeakerNotes>
  Create a Table of Contents JSX component to map through all of the headers and
  display them as list items with links. There's an autolink plugin to ensure
  the anchor link exists.
</SpeakerNotes>

---

```jsx
import { MDXProvider } from "@mdx-js/react";
import { MDXRenderer } from "gatsby-plugin-mdx";
import TableOfContents from "../components/TableOfContents";

const components = {
  TableOfContents,
};

class BlogPostTemplate extends React.Component {
  render() {
    const post = this.props.data.mdx;
    if (!post) return null;

    return (
      <MDXProvider components={components}>
        <MDXRenderer>{post.body}</MDXRenderer>
      </MDXProvider>
    );
  }
}
```

<SpeakerNotes>
  We need to import the new Table of Contents component into the MDX provider,
  if we want this component to be accessible to all blog posts
</SpeakerNotes>{" "}

---

# Before/After: Table of Contents Component

<img style={{ maxWidth: "80%", textAlign: "center" }} src="/toc-diff.png" />

---

# Callout Banners

<Callout>Here's some important information for you to know!</Callout>
<Callout variant="danger">Oops, there was an error</Callout>
<Callout variant="garden">
  That's all for now! ü•ï I am continuing to update this post, so check back
  later!
</Callout>
<Callout variant="book">
  "Here's a great quote from something I read recently.
</Callout>

---

# Markdown Quote -> JSX Callout Banners

```
> Markdown quote
```

to

```jsx
<>
  <Callout>...</Callout>
  <Callout variant="danger">...</Callout>
  <Callout variant="garden">...</Callout>
  <Callout variant="book">...</Callout>
</>
```

---

# JSX Callout Variants

```jsx
const variantStyles = {
  info: {
    borderLeft: "4px solid #b4aaff",
    backgroundColor: "rgba(224, 226, 255, 0.5)",
    color: "#2a2135",
  },
  danger: {
    borderLeft: "4px solid #ff7828",
    backgroundColor: "rgb(253, 236, 234)",
  },
  garden: {
    borderLeft: "4px solid #72bc23",
    backgroundColor: "rgb(249, 253, 234)",
  },
  book: {
    borderLeft: "4px solid #44a9ba",
    backgroundColor: "rgb(234, 248, 253);",
  },
};
```

---

```jsx
/* CSS file for pseudoclasses a.k.a emojis */
import styles from "./callout.module.scss"
export default function Callout({ variant = "info", children }) {
  const classes = `${styles.infoBox} ${styles[variant]}`;
  const variantStyles = {
    ...
  };
  return (
    <aside
      css={{
       /* a bunch of default CSS*/
        ...variantStyles[variant],
      }}
      className={classes}
    >
      {children}
    </aside>
  );
}
```

---

# Upgraded Cod Snippets

I wanted to be able to easily add additional functionality to code snippets on my site like click to copy functionality

I was using `gatsby-remark-prismjs` and ran into some issue since currently additional support for PrismJS plugin environment variables is [in development](https://github.com/gatsbyjs/gatsby/issues/20642).

I decided to switch to `prism-react-renderer` in order to tap into the more robust functionality that‚Äôs available with React/MDX.

Prism-react-renderer is a lot more flexible than gatsby-remark-prismjs

> I was wondering how certain websites are able to display language and copy to clipboard feature as seen in the photo below.

- Migrated from ‚Äúgatsby-remark-prismjs‚Äù to ‚Äúprism-react-renderer‚Äù: ‚Äú^1.1.1‚Äù (much fancier code snippets) üë®‚Äçüç≥ - https://github.com/M0nica/monica-site-playground/compare/improveCodeBlocks
  [image:3B3BE6B0-1B59-45ED-AFBD-93321A20DC77-75650-0001FB2ED8820415/Screen_Shot_2020-07-24_at_11.30.27_PM.png][image:5528dbcb-fd05-487e-953b-3363b990a363-75650-0001fb2ed9318c60/screen_shot_2020-07-24_at_11.30.31_pm.png]

[file:F5F1DD06-53F8-4737-8E89-2CCF805CB5F0-75650-0001FBA5BFC7F365/2020-07-25-upgrading-code-snippets-migrating-to-prism-react-renderer.md]

---

Things I want to explore in MDX:
A production-focused playground for live editing React code. üëÄ
https://formidable.com/open-source/react-live/

---

# Thank you üëãüèæ

</SlidePage>
